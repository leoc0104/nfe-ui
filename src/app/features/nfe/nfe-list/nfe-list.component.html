<div>
  <!-- Header -->
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Notas de Entrada</h1>
      <p class="text-gray-500 text-sm mt-1">
        @if (!loading()) {
          {{ totalItems() }} nota(s) encontrada(s)
        }
      </p>
    </div>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    @if (loading()) {
      <div class="flex items-center justify-center py-20">
        <svg class="animate-spin w-8 h-8 text-blue-500" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
      </div>
    } @else if (nfes().length === 0) {
      <div class="flex flex-col items-center justify-center py-20 text-gray-400">
        <svg class="w-14 h-14 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <p class="text-base font-medium">Nenhuma nota fiscal encontrada</p>
        <p class="text-sm mt-1">Faça o upload de arquivos XML para começar.</p>
      </div>
    } @else {
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-gray-50 border-b border-gray-200 text-left">
              <th class="px-6 py-3 font-semibold text-gray-600">Número</th>
              <th class="px-6 py-3 font-semibold text-gray-600">Série</th>
              <th class="px-6 py-3 font-semibold text-gray-600">Emitente</th>
              <th class="px-6 py-3 font-semibold text-gray-600">CNPJ</th>
              <th class="px-6 py-3 font-semibold text-gray-600">Data</th>
              <th class="px-6 py-3 font-semibold text-gray-600 text-right">Valor Total</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            @for (nfe of nfes(); track nfe.id) {
              <tr
                class="hover:bg-blue-50 cursor-pointer transition-colors"
                (click)="viewDetail(nfe)"
              >
                <td class="px-6 py-4 font-mono text-gray-800 font-medium">{{ nfe.number }}</td>
                <td class="px-6 py-4 text-gray-600">{{ nfe.series }}</td>
                <td class="px-6 py-4 text-gray-800 max-w-[200px] truncate">{{ nfe.issuer_name }}</td>
                <td class="px-6 py-4 text-gray-500 font-mono text-xs">{{ formatCnpj(nfe.issuer_cnpj) }}</td>
                <td class="px-6 py-4 text-gray-600">{{ formatDate(nfe.issue_date) }}</td>
                <td class="px-6 py-4 text-right font-semibold text-gray-900">
                  {{ formatCurrency(nfe.total_value) }}
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      @if (totalPages > 1) {
        <div class="flex items-center justify-between px-6 py-4 border-t border-gray-200 bg-gray-50">
          <p class="text-sm text-gray-500">
            Página {{ currentPage() }} de {{ totalPages }}
          </p>
          <div class="flex items-center gap-1">
            <button
              (click)="loadPage(currentPage() - 1)"
              [disabled]="currentPage() === 1"
              class="px-3 py-1.5 rounded-lg text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed transition"
            >
              ← Anterior
            </button>

            @for (page of pages; track page) {
              @if (page === 1 || page === totalPages || (page >= currentPage() - 2 && page <= currentPage() + 2)) {
                <button
                  (click)="loadPage(page)"
                  class="px-3 py-1.5 rounded-lg text-sm font-medium border transition"
                  [class.bg-blue-600]="page === currentPage()"
                  [class.text-white]="page === currentPage()"
                  [class.border-blue-600]="page === currentPage()"
                  [class.border-gray-300]="page !== currentPage()"
                  [class.text-gray-600]="page !== currentPage()"
                  [class.hover:bg-gray-100]="page !== currentPage()"
                >
                  {{ page }}
                </button>
              }
            }

            <button
              (click)="loadPage(currentPage() + 1)"
              [disabled]="currentPage() === totalPages"
              class="px-3 py-1.5 rounded-lg text-sm font-medium border border-gray-300 text-gray-600 hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed transition"
            >
              Próxima →
            </button>
          </div>
        </div>
      }
    }
  </div>
</div>
